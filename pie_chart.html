<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	<script type="text/javascript" src="js/tooltip.js"></script>
	
	<link href='http://fonts.googleapis.com/css?family=Lato:100' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="styles/data_style.css">
	<title>Kaggle Infografic</title>

</head>
<style type="text/css">
  html,p,h2{
  font-family: 'Lato', Helvetica, sans-serif;
  font-weight: bolder;
}

p{
  font-size: 120%;
}

text {
    font: 15px 'Lato';
}

form {
  position: absolute;
  right: 230px;
  top: 300px;
}

label{
  padding: 2px;
}

</style>
<body>
	<h2>DATA</h2>
	<div id="pie">
		<p>Breakdown of categories per evergreen and perennial websites</p>
		<form>
			<label><input type="radio" name="dataset" value="Evergreen" checked> Evergreen</label>
			<label><input type="radio" name="dataset" value="Perennial"> Perennial</label>
		</form>
	</div>

</body>

<script type="text/javascript">	

// tooltip
d3.helper = {};
    d3.helper.tooltip = function(){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        var attrs = {};
        var text = '';
        var styles = {};

        function tooltip(selection){

            selection.on('mouseover.tooltip', function(pD, pI){
                var name, value;
                // Clean up lost tooltips
                d3.select('body').selectAll('div.tooltip').remove();
                // Append tooltip
                tooltipDiv = d3.select('body').append('div');
                tooltipDiv.attr(attrs);
                tooltipDiv.style(styles);
                var absoluteMousePos = d3.mouse(bodyNode);
                tooltipDiv.style({
                    left: (absoluteMousePos[0] + 10)+'px',
                    top: (absoluteMousePos[1] - 15)+'px',
                    position: 'absolute',
                    'z-index': 1001
                });
                // Add text using the accessor function, Crop text arbitrarily
                tooltipDiv.style('width', function(d, i){ return (text(pD, pI).length > 80) ? '300px' : null; })
                    .html(function(d, i){return text(pD, pI);});
            })
            .on('mousemove.tooltip', function(pD, pI){
                // Move tooltip
                var absoluteMousePos = d3.mouse(bodyNode);
                tooltipDiv.style({
                    left: (absoluteMousePos[0] + 10)+'px',
                    top: (absoluteMousePos[1] - 15)+'px'
                });
                // Keep updating the text, it could change according to position
                tooltipDiv.html(function(d, i){ return text(pD, pI); });
            })
            .on('mouseout.tooltip', function(pD, pI){
                // Remove tooltip
                tooltipDiv.remove();
            });
        }
        tooltip.attr = function(_x){
            if (!arguments.length) return attrs;
            attrs = _x;
            return this;
        };
        tooltip.style = function(_x){
            if (!arguments.length) return styles;
            styles = _x;
            return this;
        };
        tooltip.text = function(_x){
            if (!arguments.length) return text;
            text = d3.functor(_x);
            return this;
        };
        return tooltip;
    };
//End of tooltip

var margin = {top: 19.5, right: 19.5, bottom: 19.5, left: 39.5},
width = 960 - margin.right,
height = 500 - margin.top - margin.bottom;

var svg = d3.select("#pie").append("svg")
.attr("width", 960)
.attr("height", 500)
.attr("id", "pieSvg")
.append("g")
.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

//PIE CHART

var radius = Math.min(960, 500) / 2,
category = ["arts_entertainment", "business","computer_internet","culture_politics","gaming","health","law_crime","recreation","religion","science_technology","sports","unknown","weather"];

var colorS = d3.scale.category20();

var pie = d3.layout.pie()
.value(function(d) { return d.Perennial; })
.sort(null);

var arc = d3.svg.arc()
.innerRadius(radius - 100)
.outerRadius(radius - 20);
loadData();

function loadData () {
  d3.csv("total.csv", function(data){
    var path = svg.datum(data).selectAll("path")
    .data(pie)
    .enter().append("path")
    .attr("fill", function(d, i) { return colorS(i); })
    .attr("id", function (d,i) { return category[i]; })
    .attr("d", arc)
  .each(function(d) { this._current = d; }); // store the initial angles

  path.call(d3.helper.tooltip()
     .style({color: 'black'})
     .text(function(d, i){ return d.category; })
     )
  .on('mouseover', function(d, i){ d3.select(this).style({opacity: '0.7'}); })
  .on('mouseout', function(d, i){ d3.select(this).style({opacity: '1.0'}); });

  d3.selectAll("input")
  .on("change", change);

  var timeout = setTimeout(function() {
    d3.select("input[value=\"Evergreen\"]").property("checked", true).each(change);
    d3.select("input[value=\"Perennial\"]").property("checked", true).each(change);
  }, 2000);

  function change() {
    var value = this.value;
    clearTimeout(timeout);

  pie.value(function(d) { return d[value]; }); // change the value function
  path = path.data(pie); // compute the new angles
  path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
  
  path.call(d3.helper.tooltip()
     .style({color: 'black'})
     .text(function(d, i){ return category[i]; })
     )
  .on('mouseover', function(d, i){ d3.select(this).style({opacity: '0.7'}); })
  .on('mouseout', function(d, i){ d3.select(this).style({opacity: '1.0'}); });
  }
});

}

function type(d) {
  d.Evergreen = +d.Evergreen;
  d.Perennial = +d.Perennial;
  return d;
}

function arcTween(a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arc(i(t));
  };
}

</script>
</html>